import{_ as U,f as b,aV as O,k as H,au as B,r as T,a4 as G,ay as V,E as W,w as j,a0 as q,h as L,o as c,c as f,a as o,i as d,t as p,v as x,F,s as K,D as z,a1 as J,aS as Q,ae as X,p as Z,e as tt}from"./entry.e1c54084.js";const et=m=>(Z("data-v-757a5e0d"),m=m(),tt(),m),st={key:0,class:"c-modals c-modals--video"},nt={class:"c-modals__inner"},ot={class:"c-modals__video-img"},lt=["src"],at={class:"c-modals__contents"},it=et(()=>o("div",{class:"c-form-label"},"강의 안내",-1)),rt={class:"c-modals__title c-text-left"},ct={key:0,class:"c-form-label title"},dt={key:1,class:"c-modals__video-list"},mt={class:"c-modals__video-list-item"},ut={class:"c-modals__video-list-item-img"},_t=["src"],ft={class:"c-modals__video-list-item-text"},Pt=["onClick"],pt={__name:"videoModal",props:{slcIdx:{Type:String,required:!0}},emits:["close"],async setup(m,{emit:y}){let v,S;const D=m;b(),O();const I=H(),{MENTORING:{MENTORING_EDU_VIDEO_INFO:N}}=B(),{$dayjs:u}=J();let i=T({slcIdx:"",slcsIdx:"",ctntSeq:"",ctntName:"",ctntLinkUrl:"",lastPlayPosition:0,list:[]});const l={IDLE:"idle",PLAY:"play",PLAYING:"playing",STOP:"stop",PAUSE:"pause"};let e=null,t=T({intervalId:null,isWork:!1,cycle:1,sendCycle:60,sendCycleRemind:null,playStatus:l.IDLE,position:null,startPosition:null,endPosition:null,startTime:null,endTime:null,lastSendStartPosition:null,lastSendEndtPosition:null,errCnt:0,maxErrCnt:1});const Y=async()=>{await A(),t.intervalId||(t.intervalId=setInterval(()=>{t.isWork&&w()},t.cycle*1e3))},w=()=>{if(console.log(`>>>>> [${u().format("mm:ss")}] playerApi(${!!e}), player state(${e.getState()}) play position(${e.getPosition()}/${e.getDuration()})`),!e||e.getState()===l.IDLE&&t.playStatus===l.IDLE)return;const s=e.getState(),n=e.getPosition();t.startPosition!==null&&!t.sendCycleRemind?t.sendCycleRemind=t.sendCycle:t.sendCycleRemind&&(t.sendCycleRemind-=t.cycle),t.position=n,t.playStatus=e.getState(),[l.PAUSE,l.COMPLETE].includes(s)?t.endTime=u().format("YYYYMMDDHHmmss"):[l.PLAY,l.PLAYING].includes(s)&&t.endTime&&(t.endTime=null),t.sendCycleRemind<=0&&P()},P=async s=>{if(t.lastSendStartPosition===t.startPosition&&t.lastSendEndtPosition===t.endPosition){console.log(">>>>> !! Not sendPlayState");return}if(t.startPosition===t.position){console.log(">>>>> !! Not sendPlayState");return}const n=u().format("YYYYMMDDHHmmss");t.endTime||(t.endTime=n),t.lastSendStartPosition=t.startPosition,t.lastSendEndtPosition=t.position,console.log(`>>>>> call sendPlayState : ${t.startTime} (${t.lastSendStartPosition}) ~ ${t.endTime} (${t.lastSendEndtPosition})`),await L({method:"get",id:"공연 추천 검색",endpoint:"/api/sq/common/code",data:{cateId:"MENTOR_DIST"},isOveray:!1,onResponse({data:a,status:r}){r===200?(t.startPosition=t.lastSendEndtPosition,t.startTime=n,t.endPosition=null,t.endTime=null,t.sendCycleRemind=t.sendCycle,t.errCnt=0):(console.log(">>>>> error status",r),console.log(`>>>>> callback error status: ${r}, error Count: ${t.errCnt}`),t.errCnt++,[l.PLAY,l.PLAYING].includes(e.getState())&&(t.endTime=null),(s||t.errCnt>=t.maxErrCnt)&&E())},onError({error:a,status:r}){t.errCnt++,console.log(`>>>>> call onError status: ${r}, error Count: ${t.errCnt} error ${a}`),[l.PLAY,l.PLAYING].includes(e.getState())&&(t.endTime=null),(s||t.errCnt>=t.maxErrCnt)&&E()}})},E=()=>{I.alert("알림","교육 수강 진척도 정보 동기화 중 오류가 발생하였습니다.<br/>지속적으로 발생할 경우 관리자에게 문의해주세요.")},A=async()=>{await L({id:"멘토 교육 동영상 정보",endpoint:Q(N,{slcIdx:D.slcIdx}),headers:"PUBLIC",onResponse({data:s,status:n}){if(n===200)return i.list=s,h(),!0}})},g=()=>{Object.assign(t,{isWork:!1,sendCycleRemind:null,playStatus:l.IDLE,position:null,startPosition:null,endPosition:null,startTime:null,endTime:null,lastSendStartPosition:null,lastSendEndtPosition:null,errCnt:0})},h=async s=>{e&&e.stop(),await P(!0),g();let n={...s?i.list.filter(a=>a.slcsIdx===s)[0]:i.list[0]};if(n.ctntLinkUrl||I.alert("알림","강의 동영상 정보를 찾을 수 없습니다.<br/>관리자에게 문의해주세요."),n.ctntLinkUrl&&n.ctntLinkUrl.indexOf("api.wecandeo.com")>=0){let a=new URL(n.ctntLinkUrl).searchParams;a.has("k")&&(n.ctntLinkUrl=`https://play.wecandeo.com/video/v/?key=${a.get("k")}`)}n.lastPlayPosition&&Number(n.lastPlayPosition)>0&&(n.ctntLinkUrl+=`&start=${n.lastPlayPosition}`),Object.assign(i,{...n})},R=()=>{$()},$=()=>{if(console.log(">>>>> call initPlayerApi",e),!e){const s=document.getElementById("eduPlayer");let n=s.contentWindow||s.contentDocument;e=new smIframeAPI(n),M()}},M=()=>{e.onEvent(smIframeEvent.COMPLETE,()=>{console.log(">>>>> complete"),P(!0),g()}),e.onEvent(smIframeEvent.TIME,s=>{t.startPosition===null&&(t.startPosition=e.getPosition(),t.startTime=u().format("YYYYMMDDHHmmss"),t.position=e.getPosition(),t.isWork=!0)}),e.onEvent(smIframeEvent.SEEK,s=>{console.log("재생위치변경(seek)",s)}),e.onEvent(smIframeEvent.ERROR,function(s){console.error(">>>>> error",s)})},C=()=>t.intervalId?(clearInterval(t.intervalId),t.isWork=!1,!0):!1,k=()=>{C()?X(()=>{y("close")}):y("close")};return G(()=>{e==null||e.destroy(),C(),P(!0)}),[v,S]=V(()=>Y()),await v,S(),(s,n)=>(c(),W(q,{name:"c-modals"},{default:j(()=>{var a,r;return[(c(),f("div",st,[o("div",{class:"c-modals__bg",onClick:k}),o("div",nt,[o("div",{class:"c-modals__head"},[o("button",{class:"c-modals__head-close",type:"submit",onClick:k}," 닫기 ")]),o("div",ot,[o("iframe",{id:"eduPlayer",width:"100%",height:"100%",src:d(i).ctntLinkUrl,frameborder:"0",allowfullscreen:"",style:{position:"absolute"},onLoad:R},null,40,lt)]),o("div",at,[it,o("div",rt,p(d(i).ctntName),1),((a=d(i).list)==null?void 0:a.length)>1?(c(),f("div",ct,"강의 목록")):x("",!0),((r=d(i).list)==null?void 0:r.length)>1?(c(),f("div",dt,[(c(!0),f(F,null,K(d(i).list,_=>(c(),f("div",mt,[o("div",ut,[o("img",{src:_.filePath||_.imageUrl,alt:""},null,8,_t)]),o("div",ft,[o("a",{href:"javascript:void(0);",style:{cursor:"pointer"},onClick:z(yt=>h(_.slcsIdx),["prevent"])},p(_.ctntName),9,Pt),o("span",null,p(d(u)("0000-00-00").set("s",_.duration).format("HH:mm:ss")),1)])]))),256))])):x("",!0)])])]))]}),_:1}))}},St=U(pt,[["__scopeId","data-v-757a5e0d"]]);export{St as default};
