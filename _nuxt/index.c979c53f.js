import{_ as N}from"./breadCrumbs.86a21415.js";import{_ as q}from"./title.fb65f11f.js";import{_ as K}from"./Checkbox.20dceeb0.js";import{_ as T}from"./NoData.3efb81a9.js";import{_ as V,k as R,V as L,r as O,g as j,af as A,h as g,aU as _,c as v,b as p,a as e,w as Y,i as l,t as f,$ as G,d as S,F as P,s as W,v as C,E as H,o as h,y as x,n as F,A as J,C as Q,p as X,e as Z,N as ee}from"./entry.e1c54084.js";import te from"./_snb.5c7ca73e.js";import ae from"./_snbTablet.5be258ab.js";import se from"./_uploadModal.b8cf1468.js";import"./ch-nodata.e12229c9.js";import"./1.5c1c421a.js";import"./Input.9ccbf189.js";const k=m=>(X("data-v-a002a32f"),m=m(),Z(),m),le={class:"mypage"},oe={class:"mypage-drive"},ne={class:"mypage__wrap"},ce={class:"mypage__contents"},ie={class:"mypage__contents-head"},re={class:"mypage__contents-progress"},de={class:"mypage__contents-progress-head"},pe={class:"c-progress"},fe={class:"mypage__contents-body"},ue={class:"mypage__table-wrap"},_e={class:"mypage__table-head"},he={class:"c-form-group c-form-group--inline"},me={class:"c-table__head-select"},ge={class:"c-text-danger"},ve={class:"c-table c-table-center"},be=k(()=>e("caption",null," 내 드라이브 목록으로 파일이름, 크기, 첨부일자 를 볼 수 있습니다. ",-1)),ye=k(()=>e("colgroup",null,[e("col",{width:"64"}),e("col"),e("col",{width:"100"}),e("col",{width:"140"})],-1)),ke=k(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"}),e("th",{scope:"col"},"파일 이름"),e("th",{scope:"col"},"크기"),e("th",{scope:"col"},"첨부 일자")])],-1)),De={key:0},Se={class:"c-form-check c-form-check--type04"},Ce=["id","value"],xe=["for"],Fe={class:"c-table__title"},Me={__name:"index",setup(m){const i=R(),D=L(),t=O({titleDesc:"",sort:"fileSize",masterFilter:!1,checkData:[],data:{driver:{},myfiles:[]},uploadModal:null,fileInfo:{}});j(()=>{y(),b()});const b=async()=>{t.fileInfo=await A("drive");const a=t.fileInfo.attaFileUseExt.split(",");if(a.length>7){const s=Math.floor(a.length/2),o=a.slice(0,s),r=a.slice(s,a.length);t.titleDesc=`필요한 파일은 언제 어디서나 올리고 다운받으세요.<br/>${o}<br/>${r} 형식으로 최대 10MB 첨부 가능`}else t.titleDesc=`필요한 파일은 언제 어디서나 올리고 다운받으세요.<br/>${t.fileInfo.attaFileUseExt}>형식으로 최대 10MB 첨부 가능`},M=a=>{console.log(a);let s="etc";switch(a){case"mp4":case"avi":case"mov":s="vod";break;case"doc":case"docx":case"ppt":case"pptx":case"xls":case"xlsx":case"pdf":case"hwp":case"txt":s="doc";break;case"gif":case"jpg":case"jpeg":case"png":case"bmp":s="pic";break;case"zip":s="zip";break}return s},w=a=>{try{let s=a.target.files[0].size/1048576,o=t.fileInfo.attaFileMaxSize,r=_(t.data.driver.unusedSize);if(console.log("fileSize>>>>",s),console.log("maxSize>>>>",o),s>o)return i.alert("알림",`첨부파일 사이즈는 ${t.fileInfo.attaFileMaxSize}MB 이내로 등록 가능합니다.`),!1;if(s>r)return i.alert("알림","파일 사용용량이 가득 찼습니다. <br/>파일 정리 후 다시 시도해주시길 바랍니다"),!1;let n=a.target.files[0].name,d=t.fileInfo.attaFileUseExt.split(","),c=n.substr(n.lastIndexOf(".")+1).toUpperCase();if(d.filter(u=>u===c).length===0)return i.alert("알림","파일등록이 불가능한 확장자입니다. <br/> 파일을 확인 후 다시 시도해주시길 바랍니다."),!1}catch(s){console.log("내드라이브 try catch err >>> ",s)}return!0},z=a=>{if(a){for(const s in t.data.myfiles){const o=t.data.myfiles[s].dvFlSeq;t.checkData.indexOf(o)<0&&t.checkData.push(o)}t.masterFilter=!0}else t.checkData=[],t.masterFilter=!1},I=()=>{t.checkData.length==t.data.myfiles.length?t.masterFilter=!0:t.masterFilter=!1},B=async()=>{if(t.checkData.length<=0){i.alert("알림","선택하신 파일이 없습니다. 파일 선택 후 다시 시도해주시길 바랍니다.");return}i.confirm("알림","파일 삭제시 다시 복구 할 수 없습니다. 삭제하시겠습니까?",()=>{g({id:"마이페이지 내 드라이브 파일 삭제",endpoint:"/api/sq/mydrive/file",method:"delete",data:{dvFlSeqList:t.checkData.toString()},onResponse({data:a}){return i.alert("알림","파일 삭제가 완료되었습니다."),y(),b(),t.checkData=[],t.masterFilter=!1,!0}})})},U=async a=>{if(!w(a))return a.target.value="",!1;let o=a.target.files[0];await g({id:"마이페이지 내 드라이브 파일 업로드 하기",endpoint:"/api/sq/mydrive/file",headers:"FILE_UPLOAD",method:"post",data:{file:o},onResponse({data:n,status:d}){return d===200?(i.alert("알림","파일 업로드가 완료되었습니다."),y(),b()):i.alert("알림","파일 업로드에 실패하였습니다."),!0}})||i.alert("알림","파일 업로드에 실패하였습니다."),a.target.value=""},$=async()=>{if(t.checkData.length<=0){i.alert("알림","선택하신 파일이 없습니다. 파일 선택 후 다시 시도해주시길 바랍니다.");return}else if(t.checkData.length>1){i.alert("알림","파일 다운은 1건씩만 가능합니다. 1건 선택 후 다시 시도해주세요.");return}await g({id:"마이페이지 내 드라이브 파일 다운로드",endpoint:"/api/sq/mydrive/file",headers:"PUBLIC",responseType:"blob",data:{dvFlSeq:t.checkData[0]},onResponse({response:a,headers:s}){const o=new Blob([a]),r=window.URL.createObjectURL(o);console.log("fileUrl>>",r);const n=document.createElement("a");n.href=r,n.style.display="none";const d=()=>{const c=s["content-disposition"];return decodeURI(c.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/)[1].replace(/['"]/g,""))};return n.download=d(),document.body.appendChild(n),n.click(),n.remove(),!0}})},y=async()=>{await g({id:"마이페이지 내 드라이브 조회",endpoint:"/api/sq/mydrive/info",data:{order:"DESC",sort:t.sort},onResponse({data:a}){return console.log("조회데이터 >>",a),t.data=a,t.data.myfiles.map(s=>{const o=_(s.fileSize,1);s.fileSize=o<0?`${s.fileSize}KB`:`${o}MB`}),!0}})},E=()=>{D.value.click()};return(a,s)=>{const o=N,r=q,n=K,d=T;return h(),v("div",le,[p(ae),p(o),e("div",oe,[e("div",ne,[p(te),e("div",ce,[e("div",ie,[p(r,{title:"내 드라이브 관리",desc:l(t).titleDesc},{tail:Y(()=>[x(e("input",{id:"file",class:"c-form-control",type:"file",ref_key:"fileUpload",ref:D,title:"파일 첨부",placeholder:"파일을 첨부해주세요.",onChange:U},null,544),[[ee,!1]]),e("button",{class:"c-btn c-btn-sm c-btn-danger",onClick:E}," 파일 찾기 ")]),_:1},8,["desc"]),p(se,{modalKey:l(t).uploadModal},null,8,["modalKey"])]),e("div",re,[e("div",de,[e("p",null," 1GB 중 "+f(("uConvertKbToMb"in a?a.uConvertKbToMb:l(_))(l(t).data.driver.usedSize))+"MB 사용 중 ",1),e("span",null,"여유 "+f(("uConvertKbToMb"in a?a.uConvertKbToMb:l(_))(l(t).data.driver.unusedSize))+"MB",1)]),e("div",pe,[e("span",{class:"c-progress-bar",style:G({width:("uConvertKbToMb"in a?a.uConvertKbToMb:l(_))(l(t).data.driver.usedSize)+"%"})},null,4)])]),e("div",fe,[e("div",ue,[e("div",_e,[e("div",he,[p(n,{modelValue:l(t).masterFilter,"onUpdate:modelValue":z,text:"전체 선택",textWrap:!1},null,8,["modelValue"]),e("div",me,[e("span",ge,f(l(t).checkData.length),1),S("개 선택 ")]),e("ul",null,[e("li",null,[e("button",{onClick:B},"삭제하기")]),e("li",null,[e("button",{onClick:$},"내려받기")])])])]),e("table",ve,[be,ye,ke,l(t).data.myfiles.length>0?(h(),v("tbody",De,[(h(!0),v(P,null,W(l(t).data.myfiles,c=>(h(),v("tr",{class:F({active:l(t).checkData.indexOf(c)>=0})},[e("td",null,[e("div",Se,[x(e("input",{class:"c-form-check-input",type:"checkbox",id:`check${c.dvFlSeq}`,value:c.dvFlSeq,"onUpdate:modelValue":s[0]||(s[0]=u=>l(t).checkData=u),onChange:s[1]||(s[1]=u=>I())},null,40,Ce),[[J,l(t).checkData]]),e("label",{class:"c-form-check-label",for:`check${c.dvFlSeq}`},null,8,xe)])]),e("td",Fe,[e("p",null,[e("i",{class:F(`ico ico-${M(c.fileExt)}`)},"파일 이미지",2),S(" "+f(c.flOriName),1)])]),e("td",null,f(c.fileSize),1),e("td",null,f(("uConvertDate"in a?a.uConvertDate:l(Q))(c.updDtm,"YYYY.MM.DD")),1)],2))),256))])):C("",!0)]),l(t).data.myfiles.length<=0?(h(),H(d,{key:0,contents:"데이터가 없습니다."})):C("",!0)])])])])])])}}},Ve=V(Me,[["__scopeId","data-v-a002a32f"]]);export{Ve as default};
